# üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫ (FastAPI)

## üîë –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### POST `/auth/register`

–°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º email –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–∞—Ä–æ–ª—å.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞

| –ù–∞–∑–≤–∞–Ω–∏–µ | –¢–∏–ø   | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ                      |
|----------|-------|--------------|-------------------------------|
| `email`  | String| ‚úÖ –î–∞        | Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ |

#### –ü—Ä–∏–º–µ—Ä —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞ (JSON):

```json
{
    "email": "user@example.com"
}
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:

```json
{
    "message": "User created",
    "generated_password": "A1b2C3d4"
}
```

---

## ‚ú® –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–∏

### POST `/links/shorten`

–°–æ–∑–¥–∞—ë—Ç –∫–æ—Ä–æ—Ç–∫—É—é —Å—Å—ã–ª–∫—É –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ URL.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ (—Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞, JSON)

| –ù–∞–∑–≤–∞–Ω–∏–µ       | –¢–∏–ø      | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ                           |
|----------------|----------|--------------|------------------------------------|
| `url`          | String   | ‚úÖ –î–∞        | –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL                   |
| `custom_alias` | String   | ‚ùå –ù–µ—Ç       | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥      |
| `expires_at`   | DateTime | ‚ùå –ù–µ—Ç       | –î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏ (ISO —Ñ–æ—Ä–º–∞—Ç) |

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ (query-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã)

| –ù–∞–∑–≤–∞–Ω–∏–µ   | –¢–∏–ø    | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ                   |
|------------|--------|--------------|----------------------------|
| `email`    | String | ‚ùå –ù–µ—Ç       | Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è         |
| `password` | String | ‚ùå –ù–µ—Ç       | –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è        |

#### –ü—Ä–∏–º–µ—Ä —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞:

```json
{
    "url": "https://example.com",
    "custom_alias": "myalias",
    "expires_at": "2025-04-01T00:00:00"
}
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:

```json
{
    "short_url": "http://127.0.0.1/links/myalias",
    "short_code": "myalias"
}
```

---

## üîé –ü–æ–∏—Å–∫ —Å—Å—ã–ª–∫–∏ –ø–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É URL

### GET `/links/search`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–∫—Ä–∞—â—ë–Ω–Ω—ã–π –∫–æ–¥ –ø–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É URL.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞

| –ù–∞–∑–≤–∞–Ω–∏–µ | –¢–∏–ø    | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ                   |
|----------|--------|--------------|----------------------------|
| `url`    | String | ‚úÖ –î–∞        | –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL –¥–ª—è –ø–æ–∏—Å–∫–∞|

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:

```
GET /links/search?url=https://example.com
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:

```json
{
    "short_code": "myalias",
    "original_url": "https://example.com"
}
```

---

## üåê –ü–µ—Ä–µ—Ö–æ–¥ –ø–æ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–µ

### GET `/links/{short_code}`

–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Ç–∏

| –ù–∞–∑–≤–∞–Ω–∏–µ     | –¢–∏–ø    | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ             |
|--------------|--------|--------------|----------------------|
| `short_code` | String | ‚úÖ –î–∞        | –ö–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥ —Å—Å—ã–ª–∫–∏  |

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:

```
GET /links/myalias
```

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã:

- **HTTP 307**: –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL  
- **HTTP 404**: —Å—Å—ã–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞  
- **HTTP 410**: —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å—Å—ã–ª–∫–∏ –∏—Å—Ç—ë–∫

---

## üìä –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —Å—Å—ã–ª–∫–µ

### GET `/links/{short_code}/stats`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Å—Å—ã–ª–∫–µ.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Ç–∏

| –ù–∞–∑–≤–∞–Ω–∏–µ     | –¢–∏–ø    | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ             |
|--------------|--------|--------------|----------------------|
| `short_code` | String | ‚úÖ –î–∞        | –ö–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥ —Å—Å—ã–ª–∫–∏  |

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:

```
GET /links/myalias/stats
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:

```json
{
    "original_url": "https://example.com",
    "created_at": "2025-03-30T12:00:00",
    "last_accessed_at": "2025-03-31T14:00:00",
    "click_count": 15,
    "expires_at": "2025-04-01T00:00:00"
}
```

---

## üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏ (—Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü)

### DELETE `/links/{short_code}`

–£–¥–∞–ª—è–µ—Ç —Å—Å—ã–ª–∫—É. –¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Ç–∏

| –ù–∞–∑–≤–∞–Ω–∏–µ     | –¢–∏–ø    | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ             |
|--------------|--------|--------------|----------------------|
| `short_code` | String | ‚úÖ –î–∞        | –ö–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥ —Å—Å—ã–ª–∫–∏  |

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)

| –ù–∞–∑–≤–∞–Ω–∏–µ   | –¢–∏–ø    | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ           |
|------------|--------|--------------|--------------------|
| `email`    | String | ‚úÖ –î–∞        | Email –≤–ª–∞–¥–µ–ª—å—Ü–∞    |
| `password` | String | ‚úÖ –î–∞        | –ü–∞—Ä–æ–ª—å –≤–ª–∞–¥–µ–ª—å—Ü–∞   |

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:

```
DELETE /links/myalias?email=user@example.com&password=secret
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:

```json
{
    "message": "Link deleted"
}
```

---

## ‚úèÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ –∫–æ–¥–∞ —Å—Å—ã–ª–∫–∏ (—Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü)

### PUT `/links/{short_code}`

–ü–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Å—ã–ª–∫–∏.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Ç–∏

| –ù–∞–∑–≤–∞–Ω–∏–µ     | –¢–∏–ø    | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ                  |
|--------------|--------|--------------|---------------------------|
| `short_code` | String | ‚úÖ –î–∞        | –¢–µ–∫—É—â–∏–π –∫–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥ —Å—Å—ã–ª–∫–∏|

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞

| –ù–∞–∑–≤–∞–Ω–∏–µ         | –¢–∏–ø    | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ                |
|------------------|--------|--------------|-------------------------|
| `new_short_code` | String | ‚úÖ –î–∞        | –ù–æ–≤—ã–π –∫–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥      |
| `email`          | String | ‚úÖ –î–∞        | Email –≤–ª–∞–¥–µ–ª—å—Ü–∞         |
| `password`       | String | ‚úÖ –î–∞        | –ü–∞—Ä–æ–ª—å –≤–ª–∞–¥–µ–ª—å—Ü–∞        |

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:

```
PUT /links/myalias?new_short_code=newalias&email=user@example.com&password=secret
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:

```json
{
    "message": "Link updated"
}
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è —Å—Å—ã–ª–æ–∫ (—Å–∫—Ä—ã—Ç—ã–π endpoint)

### POST `/config/set_expiration`

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–µ—Ä–∏–æ–¥ (–≤ –¥–Ω—è—Ö) –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Å—Å—ã–ª–æ–∫. –î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω —Ç–æ–∫–µ–Ω–æ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞

| –ù–∞–∑–≤–∞–Ω–∏–µ       | –¢–∏–ø    | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ                            |
|----------------|--------|--------------|-------------------------------------|
| `days`         | Integer| ‚úÖ –î–∞        | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–ª—è –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫|
| `access_token` | String | ‚úÖ –î–∞        | –ê–¥–º–∏–Ω-—Ç–æ–∫–µ–Ω (`ADMIN_TOKEN`)         |

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:

```
POST /config/set_expiration?days=15&access_token=your_admin_token
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:

```json
{
    "message": "Default expiration changed to 15"
}
```

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQLite

–§–∞–π–ª –ë–î: `shortener.db`

### –¢–∞–±–ª–∏—Ü–∞ `users`

| –ü–æ–ª–µ            | –¢–∏–ø         | –û–ø–∏—Å–∞–Ω–∏–µ                      |
|-----------------|-------------|-------------------------------|
| `id`            | INTEGER (PK)| –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä      |
| `email`         | TEXT        | Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è   |
| `password_hash` | TEXT        | –•–µ—à –ø–∞—Ä–æ–ª—è                    |
| `created_at`    | DATETIME    | –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏              |

### –¢–∞–±–ª–∏—Ü–∞ `links`

| –ü–æ–ª–µ               | –¢–∏–ø            | –û–ø–∏—Å–∞–Ω–∏–µ                           |
|--------------------|----------------|------------------------------------|
| `id`               | INTEGER (PK)   | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä           |
| `short_code`       | TEXT           | –ö–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥ —Å—Å—ã–ª–∫–∏        |
| `original_url`     | TEXT           | –ò—Å—Ö–æ–¥–Ω—ã–π URL                       |
| `user_id`          | INTEGER (FK)   | –°—Å—ã–ª–∫–∞ –Ω–∞ `users.id` |
| `created_at`       | DATETIME       | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è                      |
| `last_accessed_at` | DATETIME       | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞           |
| `click_count`      | INTEGER        | –°—á—ë—Ç—á–∏–∫ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤                  |
| `expires_at`       | DATETIME       | –î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è      |
